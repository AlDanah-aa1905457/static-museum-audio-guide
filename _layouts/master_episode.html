<script>
  document.addEventListener('DOMContentLoaded', function() {
    console.log("Document ready - Initializing player");

    // Initialize with static English audio
    const defaultAudioPath = "{{ site.baseurl }}{{ site.audio_path }}{{ page.audio_file_en }}";
    console.log("Default audio path:", defaultAudioPath);

    $("#jquery_jplayer_1").jPlayer({
      ready: function() {
        console.log("jPlayer ready - setting media");
        $(this).jPlayer("setMedia", {
          mp3: defaultAudioPath
        });

        // Enable controls after initialization
        $('.jp-controls').css('pointer-events', 'auto');
        $('.jp-play').prop('disabled', false);
        console.log("Play button enabled");
      },
      cssSelectorAncestor: "#jp_container_1",
      swfPath: "{{ site.baseurl }}/js",
      supplied: "mp3",
      useStateClassSkin: true,
      autoBlur: false,
      smoothPlayBar: true,
      keyEnabled: true,
      remainingDuration: true,
      toggleDuration: true
    }).bind($.jPlayer.event.error, function(event) {
      console.error("jPlayer error:", event.jPlayer.error);
    });

    // Language toggle setup
    const toggleButton = document.createElement('button');
    toggleButton.id = 'toggle-language';
    toggleButton.style = 'background: none; border: none; font-size: 25px; cursor: pointer; margin-left: auto;';
    toggleButton.title = 'Toggle Language';
    toggleButton.innerHTML = '🌐';

    const sectionTitleContainer = document.querySelector('.post-header-section-title');
    if (sectionTitleContainer) {
      sectionTitleContainer.appendChild(toggleButton);
    }

    toggleButton.addEventListener('click', function() {
      console.log("Language toggle clicked");

      const isPlaying = !$("#jquery_jplayer_1").data().jPlayer.status.paused;
      const currentTime = $("#jquery_jplayer_1").data().jPlayer.status.currentTime;
      console.log("Current playing status:", isPlaying, "Current time:", currentTime);

      const elementsEn = document.querySelectorAll('[id$="-en"]');
      const elementsAr = document.querySelectorAll('[id$="-ar"]');
      const isEnglish = elementsEn[0].style.display !== 'none';

      console.log("Switching language. Is currently English?", isEnglish);

      elementsEn.forEach(el => el.style.display = isEnglish ? 'none' : 'block');
      elementsAr.forEach(el => el.style.display = isEnglish ? 'block' : 'none');

      // Switch audio source
      const newAudioPath = isEnglish 
        ? "{{ site.baseurl }}{{ site.audio_path }}{{ page.audio_file_ar }}"
        : "{{ site.baseurl }}{{ site.audio_path }}{{ page.audio_file_en }}";

      console.log("New audio path:", newAudioPath);

      $("#jquery_jplayer_1").jPlayer("setMedia", { mp3: newAudioPath });

      if (isPlaying) {
        console.log("Resuming play at time:", currentTime);
        $("#jquery_jplayer_1").jPlayer("play", currentTime);
      }
    });
  });
</script>
